apply plugin: 'java'
apply plugin: 'application'
apply plugin: 'checkstyle'

mainClassName = 'init'

checkstyle {
    toolVersion '8.31'
    configFile file("../checkstyle.xml")
}
checkstyleMain {
    source ='src/main/java'
}

repositories {
    mavenCentral()
}

sourceCompatibility = 21
targetCompatibility = 21

dependencies {
    implementation (
        'com.amazonaws:aws-lambda-java-core:1.2.3',
        'com.amazonaws:aws-lambda-java-events:3.11.4',
        'com.amazonaws:aws-java-sdk-ssm:1.12.649',
        'com.amazonaws:aws-java-sdk-cloudwatch:1.12.649',
        'com.amazonaws:aws-java-sdk-secretsmanager:1.12.649',
        'org.json:json:20231013'
    )
    implementation fileTree(dir: 'lib', include: '*')
}

task buildZip(type: Zip) {
    from compileJava
    from processResources              
    into('lib') {
        from configurations.runtimeClasspath
    }           
}

run {
    jvmArgs = ['-Djava.library.path=./lib/']
}

build.dependsOn buildZip